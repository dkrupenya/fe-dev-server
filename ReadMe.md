### Описание
Простой сервер на node.js для разработки веб-приложения.
* отдаёт статические файлы
* отдаёт шаблоны handlebars
* позволяет настраивть компиляцию шаблонов с использованием статических данных или с использованием результатов http-запроса
* MongoDb-подобное хранилище с настраиваемыми коллекциями 
* REST API, которое предоставляет базовые операции над документами в коллекциях (CRUD)
* загрузка файлов на сервер
* подписки с нотификациями об изменениях в коллекциях (Websocket)

### Установка
```
    git clone https://github.com/dkrupenya/fe-dev-server.git
    cd fe-dev-server
    npm install
    node ./bin/www
```
Это запустит дев сервер с конфигурацией по умолчанию.
Откройте ```http://localhost:3000/index.html``` чтобы посмотреть на возможности сервера.
Комментарии в файле ```/sample/settings.js``` помогут понять как он настраивается.

Для создания своего проекта скопируйте все файлы из ```/sample``` в свою директорию и запускайте сервер командой
```
    node ./bin/www ../path-to-settings-file-in-my-project
```  
### Статические файлы
Укажите ``staticPath`` в  ``settings.js``. Файлы из этой папки будут доступны по адресу ``http://localhost:3000/``

Если сервер видит ``.scss`` он попытается его сконвертировать в .css, но это не точно

### Handlebars
На сервере используется express-handlebars, который обеспечивает поддержку layouts, templates, partials (см. документацию).

Для настройки сервера необходимо задать в settings.js пути до папок с шаблонами и блоками
В папке с шаблонами обязательно должны находиться файлы
* ``layout.hbs`` - содержит основной шаблон страницы, куда побключаются стили и скрипты
* ``error.hbs`` - используется для отображения ошибок
Скомпилированные шаблоны доступны по адресу ``http://localhost:3000/hbs``, но для этого
в settings.js необходимо задать массив pages, например конфигурация
```$js
 pages: [{
            path: 'my-books',
            view: 'books',
            data: { title: 'List of My Books' },
            url: 'http://localhost:3000/api/books',
        }]
```
будет означать, что по адресу ``http://localhost:3000/hbs/my-books`` будет показан результат компиляции шаблона books, 
данными для которого выступают ``data`` результат выполнения запроса по указанному ``url``.

### База данных
За конфигурацию базы данных в settings.js отвечают параметры ``dbPath`` и ``collections``.
```$js
    dbPath: 'db',
    collections: [{
        name: 'books',
        initialData: 'jsonData/books-data.json',
    }]
```
При старте сервера в папке /db будет создан файл с коллекцией books. Эта коллекция будет предзаполнена документами из books-data.json.
При следующем старте сервера books-data.json будет проигнорирован. Если вам надо вернуть коллекцию в исходное состоянени,
удалите файл /db/books и коллекция снова будет создана при рестарте сервера.

> На сервере используется tingodb, API которой сделан по образу и подобию MongoDB.

Коллекция *users* в дальнейшем будет использоваться для аутентификации пользователей и обязана содержать уникальное поле *login* и поле *password*  

В каждом документе поля *_id* и *_userId* имеют особое значение. 
* *_id* - обязательное числовое поле с уникальным идентификатором документа. Можете не задавать его, оно будет автоматически сгенерировано при добавлении документа в коллекцию.
* *_userId* - в дальнейшем будет использовано для привязки документа к пользователю

### REST API

Когда вы создаёте коллекцию, на сервере генерируется REST API для работы с этой коллекцией. 
Напимер, для коллекции *book* будут доступны следующие запросы:

##### GET http://localhost:3000/api/books
Возвращает массив со всеми документами в коллекции
    
##### GET http://localhost:3000/api/books/1
Возвращает документ с _id == 1
    
##### POST http://localhost:3000/api/books
Тело запроса должно содержать объект или массив объктов, эти объекты будут добавлены в коллекцию.

Возвращает добавленный документ или массив добавленных документов

##### PUT http://localhost:3000/api/books/1
Тело запроса должно содержать объект. Документ с _id == 1 будет заменён на объект из тела запроса.
_id не может быть изменён таким способом, он всегда остаётся прежним.

Возвращает изменённый документ

> В этом запросе для изменения документа вы можете использовать [mongodb update parameter](https://docs.mongodb.com/manual/reference/method/db.collection.update/#update-parameter)
> (так написано в документации к TingoDb, но я не тестировал)

##### DELETE http://localhost:3000/api/books/5
Удалаят документ с _id===5

Возвращает число удалённых документов: 1 - удаление прошло успешно, 0 - документ не найден

#### REST API Errors
В случае возникновения ошибки вы получите json вида
```$json
 {
    "code": "SOME_ERROR_CODE_HERE",
    "message": "описание того, что произошло"
 }
``` 
Но если всё совсем сломалось вам прилетит какой-то html. Обработка ошибок пока в стадии разработки.

### Загрузка файлов на сервер
Сконфигурируйте путь, по которому будут сохраняться файлы  - ``fileUploadPath`` в settings.js
После этого ``http://localhost:3000/upload/file`` ожидает получение формы с файлом и сохранит его по указанному пути.
Файлы с одинаковым именем молча затирают друг друга.

Форма на html странице должна содержать поле ввода с именем file
```$html
    <input type="file" name="file" />
``` 

### Уведомления об изменении файлов в коллекциях
Сервер использует ```Socket.io``` для рассылки уведомлений обо всех изменениях в коллекциях. Изменения приходят в формате
```$json
{
  "collection": "books", // имя коллекции
  "created": [], // добавленные документы
  "changes": [], // изменённые документы (их новое состояние)
  "removed": []  // _id удалённых документов
}
```

Пример с подпиской на рассылку и логированием изменений в консоль есть в папке ``/sample``.
Этот пример можно использовать при отладке приложения
 